<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:HkrpgProxy.Avalonia.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="450"
        x:Class="HkrpgProxy.Avalonia.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/sw.ico"
        Title="HKRPG.Proxy Launcher"
        MinWidth="500"
        MinHeight="450"
        Width="500"
        Height="450"
        WindowStartupLocation="CenterScreen">

	<Grid Margin="10">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Game Path -->
		<StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
			<TextBlock Text="Game Path:" VerticalAlignment="Center" Width="80"/>
			<TextBox Name="GamePathTextBox"
					Text="{Binding GamePath}"
					Width="300" 
					Margin="0,0,10,0" 
					IsEnabled="{Binding !IsProxyRunning}"/>
			<Button Content="Browse" 
					Width="80" 
					Click="BrowseButton_Click" 
					IsEnabled="{Binding !IsProxyRunning}"/>
		</StackPanel>

		<!-- Use Localhost Checkbox -->
		<CheckBox Grid.Row="1" Content="Use Localhost (127.0.0.1)" IsChecked="{Binding UseLocalhost, Mode=TwoWay}" Margin="0,0,0,10" IsEnabled="{Binding !IsProxyRunning}"/>

		<!-- IP and Port -->
		<Grid Grid.Row="2" Margin="0,0,10,10">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="Auto"/>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="Auto"/>
				<ColumnDefinition Width="100"/>
				<ColumnDefinition Width="Auto"/>
			</Grid.ColumnDefinitions>
			<TextBlock Text="IP Address:" VerticalAlignment="Center" Width="90"/>
			<TextBox Grid.Column="1" Text="{Binding IpAddress, Mode=TwoWay}" IsEnabled="{Binding IsIpAddressEnabled}" Margin="0,0,20,0"/>
			<TextBlock Grid.Column="2" Text="Port:" VerticalAlignment="Center"/>
			<TextBox Grid.Column="3" Text="{Binding Port, Mode=TwoWay}" Margin="5,0,5,0" IsEnabled="{Binding !IsProxyRunning}"/>
			<Button Grid.Column="4" Content="Save" Width="80" Command="{Binding SaveSettingsCommand}" IsEnabled="{Binding !IsProxyRunning}"/>
		</Grid>

		<!-- Control Buttons -->
		<StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,0,0,10" Spacing="10">
			<Button Content="Launch" Width="110" Command="{Binding LaunchGameCommand}" IsEnabled="{Binding !IsGameRunning}"/>
			<Button Content="Stop" Width="110" Command="{Binding StopGameCommand}" IsEnabled="{Binding IsGameRunning}"/>
			<Button Content="{Binding ServerButtonText}" Margin="55,0,0,0" Width="175" Command="{Binding StartServerCommand}" IsVisible="{Binding UseLocalhost}"/>
		</StackPanel>

		<!-- Status Text -->
		<TextBlock Grid.Row="4" Text="{Binding Status}" Margin="0,0,0,5"/>

		<!-- Log Options -->
		<Grid Grid.Row="5">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>

			<StackPanel Orientation="Horizontal" Margin="0,0,0,5">
				<CheckBox Content="Enable Logs" IsChecked="{Binding EnableLogs, Mode=TwoWay}" Margin="0,0,20,0" IsEnabled="{Binding !IsProxyRunning}"/>
				<CheckBox Content="Show Debug Logs (For Developer)" Foreground="Red" IsChecked="{Binding ShowDebugLogs, Mode=TwoWay}" IsEnabled="{Binding EnableLogs}"/>
			</StackPanel>

			<ScrollViewer Grid.Row="1" 
						  IsVisible="{Binding EnableLogs}"
						  HorizontalScrollBarVisibility="Disabled"
						  VerticalScrollBarVisibility="Auto">
				<Border Background="#F5F5F5"
						BorderBrush="#CCCCCC"
						BorderThickness="1"
						CornerRadius="3"
						Padding="8">
					<ItemsControl ItemsSource="{Binding LogEntries}">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Border Margin="0,2"
										Padding="4,2">
									<StackPanel Orientation="Horizontal">
										<TextBlock Text="{Binding Timestamp, StringFormat='[{0}]'}" 
												 FontFamily="Consolas"
												 FontSize="11.5"
												 Foreground="#666666"
												 Margin="0,0,5,0"
												 IsVisible="True"/>
										<TextBlock Text="{Binding Level, StringFormat='[{0}]'}" 
												 Foreground="{Binding Color}"
												 FontFamily="Consolas"
												 FontSize="11.5"
												 FontWeight="SemiBold"
												 Margin="0,0,5,0"
												 IsVisible="True"/>
										<SelectableTextBlock Text="{Binding Message}" 
												 FontFamily="Consolas"
												 FontSize="11.5"
												 TextWrapping="NoWrap"/>
									</StackPanel>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</Border>
			</ScrollViewer>
		</Grid>
	</Grid>
</Window>
